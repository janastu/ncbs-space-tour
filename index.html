<!--Virtual Tour of Obaid Siddiqi's Lab.
Uses Pannellum https://pannellum.org/ and routie http://projects.jga.me/routie/ -->

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
	    <title>NCBS 25</title>
	    <!--link rel="icon" href="img/Assets/ncbs_logo_header.png" type="image/png" sizes="16x16"-->
	    <meta name="description" content="" />
	    <meta name="author" content="" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link type="text/css" rel="stylesheet" href="src/css/bootstrap.css" />
		<link type="text/css" rel="stylesheet" href="src/css/header.css" />
		<link type="text/css" rel="stylesheet" href="src/css/main.css" />
        <link rel="stylesheet" href="src/js/font-awesome-4.6.3/css/font-awesome.min.css">



	<link rel="stylesheet" href="src/css/pannellum.css"/>

    <link rel="stylesheet" href="src/css/content.css"/>


    <!-- audio player css-->
    <link href="src/js/jplayer/skin/pink.flag/css/jplayer.pink.flag.css" rel="stylesheet">
    <style>
    body {

    }
   
    </style>


   
</head>

    <body>


        <!--Header-->
        <div class="">



        <!--Panorama-->
        <div id='panorama'>
                        <!-- Narration-->
                        <div id="narration" class="narration">

                            <!-- Close button -->
                            <div id="close">
                               <div class="pull-right"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button></div>
                            </div>

                            <!--Title-->
                            <div id="title" class="title-text">
                                
                            </div>
                            <div id="contents">
                                    
                            </div>
                            

                        </div>
                    </div>





        <div class="col-sm-12">
            <div class="text-center" style="margin-top:15px; font-family: 'Open Sans', sans-serif;">
                <a data-toggle="modal" data-target="#ncbs-content-policy" style="cursor: pointer;     color: #333726;">copyright &copy 2016</a>
            </div>
        </div>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="ncbs-content-policy" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
          <div class="modal-dialog" role="document">
            <div class="modal-content" style="font-family: 'Open Sans', sans-serif; border-radius:0px; color:darkcyan; background-color: #f2f2f2;">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel" style="font-family: 'Open Sans', sans-serif; ">User Agreement</h4>
              </div>
              <div class="modal-body">
             

             <p>This NCBS@25 digital exhibit contains records (images, audio and video excerpts, text) under copyright or under third party ownership. These records are given on loan to NCBS for the purposes of this exhibit. Material may only be reproduced with the explicit permission of the record owners, as mentioned in the caption for each image, and audio and video clip. The NCBS@25 About page has contact details. Any document without ownership details in the caption is in the public domain. Please respect the honour code and the generosity of the donors in sharing this material with a wider audience. 
             </p>

             <p>Please click "ACCEPT" if you agree to comply with these terms. If you do not agree to comply with these terms, click "DECLINE" after which you will be redirected to the NCBS home page.</p>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn" data-dismiss="modal" style="color:#666;">Accept & Continue</button>
                <!--button type="button" class="btn btn-primary">Save changes</button-->
              </div>
            </div>
          </div>
        </div>    </div>
          </div>
        </div>


        <!-- Audio player temmplate and COntainer -->
   <div class="media-player-container hidden" id="media-player-widget">
     <button type="button" class="close pull-left" data-dismiss="modal" aria-label="Close" aria-hidden="true">&times;</button>
    <div id="jp_selector_1" class="jp-video jp-video-270p" role="application" aria-label="media player">
     <div class="jp-type-playlist">
       <div id="jp_player_1" class="jp-jplayer" ></div>
       <div class="jp-gui">
         <div class="jp-video-play" style="display: none;">
           <button class="jp-video-play-icon" role="button" tabindex="0">play</button>
         </div>
         <div class="jp-interface">
           <div class="jp-progress">
             <div class="jp-seek-bar" style="width: 100%;">
               <div class="jp-play-bar" style="width: 8.41511%;"></div>
             </div>
           </div>
           <div class="jp-current-time" role="timer" aria-label="time"></div>
           <div class="jp-duration" role="timer" aria-label="duration"></div>
           <div class="jp-details" style="display: none;">
             <div class="jp-title" aria-label="title"></div>
           </div>
           <div class="jp-controls-holder">
             <div class="jp-volume-controls">
               <button class="jp-mute" role="button" tabindex="0">mute</button>
               <button class="jp-volume-max" role="button" tabindex="0">max volume</button>
               <div class="jp-volume-bar">
                 <div class="jp-volume-bar-value" style="width: 80%;"></div>
               </div>
             </div>
             <div class="jp-controls">
               <button class="jp-previous" role="button" tabindex="0">previous</button>
               <button class="jp-play" role="button" tabindex="0">play</button>
               <button class="jp-next" role="button" tabindex="0">next</button>
               <button class="jp-stop" role="button" tabindex="0">stop</button>
             </div>
             <div class="jp-toggles">
               <button class="jp-repeat" role="button" tabindex="0">repeat</button>
               <button class="jp-shuffle" role="button" tabindex="0">shuffle</button>
               <!--button class="jp-full-screen" role="button" tabindex="0">full screen</button-->
             </div>
           </div>
         </div>
       </div>
       <div class="jp-playlist">
         <ul style="display: block;">
           <li></li>
         </ul>
       </div>
       <div class="jp-no-solution" style="display: none;">
         <span>Update Required</span>
         To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.
       </div>
     </div>
    </div>
    </div>

    <!-- Enf=d audio player -->

    <script type="text/javascript" src="src/js/jquery.min.js"></script>

    <script type="text/javascript" src="src/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="src/js/routie.js"></script>

    <script type="text/javascript" src="src/js/underscore-min.js"></script>




    <script type="text/javascript" src="src/js/pannellum.js"></script>
    <script type="text/javascript" src="src/js/libpannellum.js"></script>
    <script type="text/javascript" src="src/js/RequestAnimationFrame.js"></script>


    <script type="text/javascript" src="data.js"></script>

    <!-- Load secondary dependencies -->



    <script type="text/javascript" src="src/js/jplayer/jplayer/jquery.jplayer.min.js"></script>
    <script type="text/javascript" src="src/js/jplayer/jplayer/jquery.jplayer.swf"></script>


      <script src="src/js/jplayer/add-on/jplayer.playlist.min.js"></script>


<!-- Load application code -->


    <script>

    $(document).ready(function($){
        console.log("1. All dependencies Loaded, loading app now...", $, pannellum);
        //initialize App object ST for Space Tour
        window.ST = window.ST || {};
        ST.narrative = window.data || data;
        // audio player config
        var cssSelector =  {jPlayer: "#jp_player_1", cssSelectorAncestor: "#jp_selector_1"};
        var playerOptions = {
          playlistOptions: {
            autoPlay: true,
            enableRemoveControls: true
          },
          swfPath: "src/js/jplayer/jplayer",
          useStateClassSkin: true,
          smoothPlayBar: true,
          supplied: "mp3"
        };
        ST.playlist = [];
        ST.player = new jPlayerPlaylist(cssSelector, ST.playlist, playerOptions);
        ST.playerDOM = $('#media-player-widget');
        var playerCloseDOM = $('#media-player-widget .close');
        playerCloseDOM.on('click', function(e){
            e.preventDefault();
            ST.player.pause();
            ST.playerDOM.addClass('hidden');
        });
        // Init App
        ST.init = function(){
            console.log("2. App init", this, this.config);
            //Routes init
            this.routeInit();
            //Pannellum viewer init
            pannellum.viewer('panorama', this.config);
            //Bind Events
            ST.bindUIEvents();
            console.log("3. App loaded, have a gud time :)");

        };

        //Route handler

        ST.routeInit = function(){
            //show
             routie('*/:name?', function(name) {
                var $sidebar = $("#narration");
                if(name.indexOf('&') > -1)
                    {
                        var temp = name.split('=');
                        ST.queryParam = temp[1];
                        ST.sideBarContentFactory(ST.queryParam);
                        if(!$sidebar.hasClass('movein')) {
                            $sidebar.removeClass('moveout');
                            $sidebar.addClass('movein');
                        }
                    }
                else
                    window.location.hash="";

            });
        }


        // Bind any UI events
        ST.bindUIEvents = function() {


            //hide
            //close fn
            $( "#close" ).click(function() {
             //$("#close").css("display", "none");
             //$("#title").css("display", "none");
             //$("#narration").css("display", "none");
             window.location.hash="panorama";
             if($("#narration").hasClass('moveout')) {
                   
                    $('#narration').removeClass('moveout');
                }
                else{
                    
                    $('#narration').removeClass('movein');
                    $('#narration').addClass('moveout');
                }

            });

        };

        //UI /UX for Sidebar templates and content
        ST.sideBarContentFactory = function(id){
            //Initialize all variables
            var titleDOM = $("#title");
            var contentsDOM = $("#contents");
            //filter data
            var content = _.find(ST.narrative, function(item, index, data){
            return item.id === id;
            });


            
            //setup Templates and compile with data
            //Title
            var titleTemplate = _.template("<h3><%=title%></h3>");

            //content
            var contentTemplate = _.template(
            "<div id='space-at-the-top' class='space-at-the-top'></div>"+
            "<p class='description'><%=description%>"+
            "<span data-tag='<%=id%>' data-component='audio' class=''></span></p>"
            
            );
            //Image template
            var imgTemplate = _.template("<div class='image-container'><div class='img-holder'><img src='<%=item%>'>"+
                        "</div></div><br><br>");

            var titleCompiled = titleTemplate({
                title: content.title
            });
            var contentCompiled = contentTemplate({
                description: content.description,
                id: content.id
            });

            //DOM Operations - to append compiled content
            //clear previous content-stale DOM
            titleDOM.html('');
            contentsDOM.html('');
            // render updated data
            titleDOM.append(titleCompiled);
            contentsDOM.append(contentCompiled);
            
            console.log(contentsDOM, "contents dom");
            // Check media type
            if(content.urls.audio){
                /*var audioTemplate = _.template("<div class='audio-container'><center><audio controls>"+
                            "<source src='<%=url%>'> type='audio/mpeg'>"+
                            "</audio></center></div>");*/
                var audioTemplate = _.template("<img src='imgs/components/small-sound.svg' data-url='<%=url%>' data-title='<%=title%>' data-interviewee='Deepti Trivedi' class='audio-icon'  onmouseover="+"this.src='imgs/components/small-sound-hover.svg'; onmouseout="+"this.src='imgs/components/small-sound.svg';>");
                console.log(content.urls.audio, "audio present");
                var audioPlayerCompiled = audioTemplate({url: content.urls.audio, title:content.title});
              
                contentsDOM.find('span').append(audioPlayerCompiled);
                contentsDOM.find('span').on('click', function(e){
                    e.preventDefault();
                    //var currentActive = _.findWhere(ST.narrative, {id: ST.queryParam});
                    var playlist = []
                    playlist.push({title: e.target.dataset.title,
                                   mp3: e.target.dataset.url,
                                   artist: e.target.dataset.interviewee
                                     });
                    console.log(playlist);
                    if(ST.playerDOM.hasClass('hidden')){
                        ST.playerDOM.removeClass('hidden');
                    }
                    
                    ST.player.setPlaylist(playlist);
                    //console.log(e.target, e.currentTarget, e.target.dataset);
                });
               /* var icon = "<span class='audio-player-trigger' data-component='audio' aria-hidden='true' data-url= '"+content.urls.audio+"'><img src='imgs/components/small-sound.svg' onmouseover='this.src='imgs/components/small-sound-hover.svg'; onmouseout='this.src='imgs/components/small-sound.svg';</span>";
                appendToDom(icon, "audio");

                function appendToDom(elm, type){
                    $("#contents").append(elm);
                    if(type == "audio"){
                       // bindAudioEvent();
                    }
                    if(type =="img"){
                       // imgViewer();
                    }
                }


                
                function bindAudioEvent(){
                    $(".audio-player-trigger").on("click", function(event){
                        console.log(event.currentTarget, event);
                        var audioPlayerDom = audioTemplate(event.currentTarget.dataset);
                        $('#contents').append(audioPlayerDom);
                    });
                }
                */

            }
       
            

            if(content.urls.img){
                _.each(content.urls.img, function(item){
                    var imgElm = imgTemplate({item:item});
                    contentsDOM.append(imgElm);
                }, this);
            }

        };

        


        //Pannellum configuration for the Space tour
        ST.config = {

        "default": {
            "firstScene": "siddiqi_office_hdr",
            "sceneFadeDuration": 2000,
            "autoLoad": true,
            "hfov": 80,
            "autoRotate": -0.4,
            "autoRotateInactivityDelay": 40000,
            "toggleFullscreen": true,
            "showZoomCtrl": true,
            "compass":false
            //"hotSpotDebug": true
        },
        
        "scenes": {
            "siddiqi_office_hdr": {
                "title": "Obaid Siddiqi's Office ",
                "type": "equirectangular",
                "panorama": "panoramas/resized/siddiqi_office_hdr.jpg",
                "hotSpots": [
                    {
                        "pitch": -12,
                        "yaw": 40,
                        "type": "info",
                        "text": "The reprint pile",
                        "URL": "#&q?i=reprints"
                    },
                    {
                        "pitch": -7,
                        "yaw": -140,
                        "type": "info",
                        "text": "On the lookout for trainee students",
                        "URL": "#&q?i=lookout"
                    },
                    {
                        "pitch": 0,
                        "yaw": 190,
                        "type": "scene",
                        "text": "Lab",
                        "sceneId": "1"
                    }
                ]
            },

            "1": {
                "title": "Lab view 1",
                "panorama": "panoramas/resized/1.jpg",
                "yaw": 85,
                "hotSpots": [
                    {
                        "pitch": -1,
                        "yaw": 85,
                        "type": "scene",
                        "text": "Obaid Siddiqi's Office",
                        "sceneId": "siddiqi_office_hdr"
                    },
                    {
                        "pitch": 0,
                        "yaw": 170,
                        "type": "scene",
                        "text": "Lab view 2",
                        "sceneId": "table_legs_hdr"
                    },
                    {
                        "pitch": -1,
                        "yaw": 88,
                        "type": "info",
                        "text": "Fly behaviour in a wind tunnel",
                        "URL": "#&q?i=wind"
                    },
                    {
                        "pitch": 15,
                        "yaw": 17,
                        "type": "info",
                        "text": "Patch clamp lab",
                        "URL": "#&q?i=patch"
                    },
                    {
                        "pitch": 16,
                        "yaw": -158,
                        "type": "info",
                        "text": "Interaction with support staff in Obaid Siddiqi's Lab",
                        "URL": "#&q?i=staff"
                    },
                ]
            },

            "table_legs_hdr": {
                "title": "Lab view 2",
                "panorama": "panoramas/resized/table_legs_hdr.jpg",
                "hotSpots": [
                    {
                        "pitch": 0,
                        "yaw": 50,
                        "type": "scene",
                        "text": "Lab view 1",
                        "sceneId": "1"
                    },
                    {
                        "pitch": 0,
                        "yaw": -50,
                        "type": "scene",
                        "text": "Lab view 3",
                        "sceneId": "2_hdr"
                    },
                    {
                        "pitch": -14,
                        "yaw": 13,
                        "type": "info",
                        "text": "Old electrode puller",
                        "URL": "#&q?i=electrode"
                    },
                    {
                        "pitch": -30,
                        "yaw": -60,
                        "type": "info",
                        "text": "Lab Meetings",
                        "URL": "#&q?i=meetings"
                    }

                ]
            },

            "2_hdr": {
                "title": "Lab view 3",
                "panorama": "panoramas/resized/2_hdr.jpg",
                "yaw":-49,
                "hotSpots": [
                    {
                        "pitch": 0,
                        "yaw": 100,
                        "type": "scene",
                        "text": "Lab view 2",
                        "sceneId": "table_legs_hdr"
                    },
                     {
                        "pitch": 0.1,
                        "yaw": -73,
                        "type": "scene",
                        "text": "Lab view 4",
                        "sceneId": "3_hdr"
                    },
                    {
                        "pitch": 2,
                        "yaw": 20,
                        "type": "info",
                        "text": "Hand drawn graphs and verification of data",
                        "URL": "#&q?i=graphs"
                    },
                    {
                        "pitch": -14,
                        "yaw": -41,
                        "type": "info",
                        "text": "The 1999 flood",
                        "URL": "#&q?i=flood"
                    }
                    
                ]
            },

            "3_hdr": {
                "title": "Lab view 4",
                "panorama": "panoramas/resized/3_hdr.JPG",
                "hotSpots": [
                    {
                        "pitch": 0,
                        "yaw": -100,
                        "type": "scene",
                        "text": "Lab view 3",
                        "sceneId": "2_hdr"
                    },
                    {
                        "pitch": 0.4,
                        "yaw": 7.8,
                        "type": "info",
                        "text": "Student Lab benches",
                        "URL": "#&q?i=benches"
                    },
                    {
                        "pitch": 2,
                        "yaw": -36,
                        "type": "info",
                        "text": "Fly maze apparatus",
                        "URL": "#&q?i=maze"
                    },
                    {
                        "pitch": 2.1,
                        "yaw": -82.9,
                        "type": "info",
                        "text": "Lab Spaces",
                        "URL": "#&q?i=spaces"
                    }

                ]
            }
        }

    };

    //Start App
    ST.init();
    });

    </script>


    </body>

</html>
